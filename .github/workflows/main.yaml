name: Builder
run-name: ${{ github.actor }} is building
on: [push]
jobs:
  build-bookworm:
    runs-on: ubuntu-latest
    container: debian:bookworm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Install dependencies
        run: |
          apt-get update
          apt-get install -y git gcc g++ curl zip unzip tar ninja-build pkg-config cmake python3 autoconf automake autoconf-archive
      - name: Install vcpkg
        run: |
          git clone https://github.com/microsoft/vcpkg.git
          ./vcpkg/bootstrap-vcpkg.sh
      - name: Build 
        run: |
          cmake --preset vcpkg -DVCPKG_TARGET_TRIPLET=x64-linux-release
          cmake --build build
        env:
          VCPKG_ROOT: ${{ github.workspace }}/vcpkg
      - name: Save binary
        uses: actions/upload-artifact@v4
        with:
          name: optift-bookworm
          path: build/optift
